package com.vision.weatherapp\n\nimport android.Manifest\nimport android.content.pm.PackageManager\nimport android.os.Bundle\nimport androidx.activity.ComponentActivity\nimport androidx.activity.compose.setContent\nimport androidx.activity.result.contract.ActivityResultContracts\nimport androidx.compose.foundation.layout.fillMaxSize\nimport androidx.compose.material3.MaterialTheme\nimport androidx.compose.material3.Surface\nimport androidx.compose.ui.Modifier\nimport androidx.core.content.ContextCompat\nimport androidx.lifecycle.ViewModelProvider\nimport com.vision.weatherapp.ui.screens.WeatherScreen\nimport com.vision.weatherapp.ui.theme.WeatherAppTheme\nimport com.vision.weatherapp.ui.viewmodel.WeatherViewModel\n\nclass MainActivity : ComponentActivity() {\n    \n    private lateinit var viewModel: WeatherViewModel\n    \n    private val locationPermissionRequest = registerForActivityResult(\n        ActivityResultContracts.RequestMultiplePermissions()\n    ) { permissions ->\n        when {\n            permissions.getOrDefault(Manifest.permission.ACCESS_FINE_LOCATION, false) -> {\n                getCurrentLocation()\n            }\n            permissions.getOrDefault(Manifest.permission.ACCESS_COARSE_LOCATION, false) -> {\n                getCurrentLocation()\n            }\n        }\n    }\n    \n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        \n        viewModel = ViewModelProvider(this)[WeatherViewModel::class.java]\n        \n        setContent {\n            WeatherAppTheme {\n                Surface(\n                    modifier = Modifier.fillMaxSize(),\n                    color = MaterialTheme.colorScheme.background\n                ) {\n                    WeatherScreen(viewModel = viewModel)\n                }\n            }\n        }\n        \n        // 请求位置权限并获取天气\n        checkLocationPermission()\n    }\n    \n    private fun checkLocationPermission() {\n        when {\n            ContextCompat.checkSelfPermission(\n                this,\n                Manifest.permission.ACCESS_FINE_LOCATION\n            ) == PackageManager.PERMISSION_GRANTED -> {\n                getCurrentLocation()\n            }\n            else -> {\n                locationPermissionRequest.launch(\n                    arrayOf(\n                        Manifest.permission.ACCESS_FINE_LOCATION,\n                        Manifest.permission.ACCESS_COARSE_LOCATION\n                    )\n                )\n            }\n        }\n    }\n    \n    private fun getCurrentLocation() {\n        // 这里简化处理，使用默认坐标（上海）\n        // 实际项目中应该使用 LocationManager 获取真实位置\n        viewModel.getWeather(latitude = 31.2304, longitude = 121.4737)\n    }\n}\n